<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>pages/Perfil/Perfil.jsx - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-App.html">App</a><ul class='methods'><li data-type='method'><a href="module-App.html#~App">App</a></li><li data-type='method'><a href="module-App.html#~AppContent">AppContent</a></li></ul></li><li><a href="module-api_axios.html">api/axios</a></li><li><a href="module-components_AdminRoute.html">components/AdminRoute</a></li><li><a href="module-components_HelpButton_AboutModal.html">components/HelpButton/AboutModal</a></li><li><a href="module-components_HelpButton_HelpButton.html">components/HelpButton/HelpButton</a></li><li><a href="module-components_HelpButton_HelpModal.html">components/HelpButton/HelpModal</a></li><li><a href="module-components_MemberRoute.html">components/MemberRoute</a></li><li><a href="module-components_Navigation_Footer.html">components/Navigation/Footer</a></li><li><a href="module-components_Navigation_Navbar.html">components/Navigation/Navbar</a></li><li><a href="module-components_PasswordValidator.html">components/PasswordValidator</a></li><li><a href="module-components_ProtectedRoute.html">components/ProtectedRoute</a></li><li><a href="module-context_AuthContext.html">context/AuthContext</a><ul class='methods'><li data-type='method'><a href="module-context_AuthContext.html#.useAuth">useAuth</a></li><li data-type='method'><a href="module-context_AuthContext.html#~getCsrfCookie">getCsrfCookie</a></li></ul></li><li><a href="module-context_LanguageContext.html">context/LanguageContext</a><ul class='methods'><li data-type='method'><a href="module-context_LanguageContext.html#.useLanguage">useLanguage</a></li></ul></li><li><a href="module-hooks_useTranslation.html">hooks/useTranslation</a><ul class='methods'><li data-type='method'><a href="module-hooks_useTranslation.html#.useTranslation">useTranslation</a></li></ul></li><li><a href="module-main.html">main</a></li><li><a href="module-pages_Admin_GestionUsuarios.html">pages/Admin/GestionUsuarios</a></li><li><a href="module-pages_Calendario_Calendario.html">pages/Calendario/Calendario</a></li><li><a href="module-pages_Composiciones_Composiciones.html">pages/Composiciones/Composiciones</a></li><li><a href="module-pages_ComposicionesInterpretadas_ComposicionesInterpretadas.html">pages/ComposicionesInterpretadas/ComposicionesInterpretadas</a><ul class='methods'><li data-type='method'><a href="module-pages_ComposicionesInterpretadas_ComposicionesInterpretadas.html#~ComposicionesInterpretadas">ComposicionesInterpretadas</a></li></ul></li><li><a href="module-pages_ConfirmacionEventos_ConfirmacionEventos.html">pages/ConfirmacionEventos/ConfirmacionEventos</a></li><li><a href="module-pages_Entidades_Entidades.html">pages/Entidades/Entidades</a></li><li><a href="module-pages_EventoUsuario_EventoUsuario.html">pages/EventoUsuario/EventoUsuario</a></li><li><a href="module-pages_Eventos_Eventos.html">pages/Eventos/Eventos</a></li><li><a href="module-pages_Eventos_FormularioEvento.html">pages/Eventos/FormularioEvento</a></li><li><a href="module-pages_Home_Home.html">pages/Home/Home</a><ul class='methods'><li data-type='method'><a href="module-pages_Home_Home.html#~AdminCard">AdminCard</a></li><li data-type='method'><a href="module-pages_Home_Home.html#~FeatureCard">FeatureCard</a></li><li data-type='method'><a href="module-pages_Home_Home.html#~PublicHome">PublicHome</a></li><li data-type='method'><a href="module-pages_Home_Home.html#~QuickAccessCard">QuickAccessCard</a></li><li data-type='method'><a href="module-pages_Home_Home.html#~UserDashboard">UserDashboard</a></li><li data-type='method'><a href="module-pages_Home_Home.html#~getEventTypeColor">getEventTypeColor</a></li></ul></li><li><a href="module-pages_Instrumentos_Instrumentos.html">pages/Instrumentos/Instrumentos</a></li><li><a href="module-pages_Login_Login.html">pages/Login/Login</a></li><li><a href="module-pages_Mensajes_DetalleMensaje.html">pages/Mensajes/DetalleMensaje</a></li><li><a href="module-pages_Mensajes_FormularioMensaje.html">pages/Mensajes/FormularioMensaje</a></li><li><a href="module-pages_Mensajes_Mensajes.html">pages/Mensajes/Mensajes</a></li><li><a href="module-pages_MensajesUsuario_MensajesUsuario.html">pages/MensajesUsuario/MensajesUsuario</a><ul class='methods'><li data-type='method'><a href="module-pages_MensajesUsuario_MensajesUsuario.html#~MensajesUsuario">MensajesUsuario</a></li></ul></li><li><a href="module-pages_MinimosEvento_MinimosEvento.html">pages/MinimosEvento/MinimosEvento</a></li><li><a href="module-pages_NotFound_NotFound.html">pages/NotFound/NotFound</a></li><li><a href="module-pages_Perfil_Perfil.html">pages/Perfil/Perfil</a></li><li><a href="module-pages_Prestamos_Prestamos.html">pages/Prestamos/Prestamos</a></li><li><a href="module-pages_Register_Register.html">pages/Register/Register</a></li><li><a href="module-pages_RegistroPendiente_RegistroPendiente.html">pages/RegistroPendiente/RegistroPendiente</a></li><li><a href="module-pages_RestablecerPassword_NuevaPassword.html">pages/RestablecerPassword/NuevaPassword</a></li><li><a href="module-pages_RestablecerPassword_RestablecerPassword.html">pages/RestablecerPassword/RestablecerPassword</a></li><li><a href="module-pages_TiposInstrumento_TiposInstrumento.html">pages/TiposInstrumento/TiposInstrumento</a></li><li><a href="module-utils_translations.html">utils/translations</a></li></ul>
    
</nav>

<div id="main">
    

    
    <h1 class="page-title">pages/Perfil/Perfil.jsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Perfil.jsx
 * @module pages/Perfil/Perfil
 * @description Página de perfil de usuario. Permite ver y editar datos personales, cambiar contraseña y, si es administrador, gestionar permisos de otros usuarios. Incluye validaciones, mensajes de éxito/error y gestión de administradores.
 * @author Rafael Rodriguez Mengual
 */

"use client"

import { useState, useEffect } from "react"
import { useNavigate } from "react-router-dom"
import {
  ArrowLeft,
  Save,
  UserRound,
  Mail,
  Phone,
  Calendar,
  Lock,
  Eye,
  EyeOff,
  CheckCircle,
  UserPlus,
  UserMinus,
  Shield,
} from "lucide-react"
import { useAuth } from "../../context/AuthContext"
import api from "../../api/axios"
import { toast } from "react-toastify"
import { useTranslation } from "../../hooks/useTranslation"
import PasswordValidator from "../../components/PasswordValidator"

/**
 * Componente de perfil de usuario.
 * Permite editar datos personales, cambiar contraseña y gestionar administradores.
 * @component
 * @returns {JSX.Element} Página de perfil.
 */
export default function Perfil() {
  /** Hook de navegación */
  const navigate = useNavigate()
  /** Usuario autenticado */
  const { user } = useAuth()
  /** Hook de traducción y lenguaje */
  const { t, language } = useTranslation()

  /** Estado de carga de datos */
  const [loading, setLoading] = useState(true)
  /** Estado de guardado */
  const [saving, setSaving] = useState(false)
  /** Mensaje de error */
  const [error, setError] = useState("")
  /** Mensaje de éxito */
  const [success, setSuccess] = useState("")
  /** Mostrar/ocultar nueva contraseña */
  const [showNewPassword, setShowNewPassword] = useState(false)
  /** Mostrar/ocultar confirmación de contraseña */
  const [showConfirmPassword, setShowConfirmPassword] = useState(false)
  /** Pestaña activa: datos, password, admin */
  const [activeTab, setActiveTab] = useState("datos")
  /** Mostrar spinner de guardado */
  const [showSpinner, setShowSpinner] = useState(false)
  /** Lista de usuarios activos */
  const [usuarios, setUsuarios] = useState([])
  /** Lista de administradores (excepto el usuario actual) */
  const [adminUsers, setAdminUsers] = useState([])
  /** Estado de carga de usuarios */
  const [loadingUsers, setLoadingUsers] = useState(false)
  /** ID de usuario seleccionado para acción admin */
  const [selectedUserId, setSelectedUserId] = useState("")
  /** Mostrar modal de gestión admin */
  const [showAdminModal, setShowAdminModal] = useState(false)
  /** Acción admin: add o remove */
  const [adminAction, setAdminAction] = useState("add")
  /** Estado de validación de contraseña */
  const [isPasswordValid, setIsPasswordValid] = useState(false)

  /** Estado del formulario de datos personales */
  const [formData, setFormData] = useState({
    nombre: "",
    apellido1: "",
    apellido2: "",
    email: "",
    telefono: "",
    fecha_nac: "",
    fecha_entrada: "",
  })

  /** Estado del formulario de cambio de contraseña */
  const [passwordData, setPasswordData] = useState({
    new_password: "",
    new_password_confirmation: "",
  })

  /**
   * Efecto para inicializar datos del usuario al cargar el componente.
   */
  useEffect(() => {
    if (user) {
      setFormData({
        nombre: user.nombre || "",
        apellido1: user.apellido1 || "",
        apellido2: user.apellido2 || "",
        email: user.email || "",
        telefono: user.telefono || "",
        fecha_nac: user.fecha_nac ? new Date(user.fecha_nac).toISOString().split("T")[0] : "",
        fecha_entrada: user.fecha_entrada ? new Date(user.fecha_entrada).toISOString().split("T")[0] : "",
      })
      setLoading(false)
    }
  }, [user])

  /**
   * Efecto para cargar usuarios y administradores si la pestaña activa es "admin".
   */
  useEffect(() => {
    if (activeTab === "admin" &amp;&amp; user &amp;&amp; user.role === "admin") {
      const fetchUsuarios = async () => {
        try {
          setLoadingUsers(true)
          const response = await api.get("/usuarios")

          const usuariosData = Array.isArray(response.data) ? response.data : response.data.data || []

          const admins = usuariosData.filter((u) => u.role === "admin" &amp;&amp; u.id !== user.id)
          const regularUsers = usuariosData.filter((u) => u.role !== "admin" &amp;&amp; u.estado === "activo")

          setAdminUsers(admins)
          setUsuarios(regularUsers)
        } catch (error) {
          console.error("Error al cargar usuarios:", error)
          toast.error("Error al cargar la lista de usuarios")
        } finally {
          setLoadingUsers(false)
        }
      }

      fetchUsuarios()
    }
  }, [activeTab, user])

  /**
   * Maneja el cambio en los campos del formulario de datos personales.
   * @param {Object} e - Evento de cambio.
   */
  const handleChange = (e) => {
    const { name, value } = e.target
    setFormData((prev) => ({ ...prev, [name]: value }))
  }

  /**
   * Maneja el cambio en los campos del formulario de contraseña.
   * @param {Object} e - Evento de cambio.
   */
  const handlePasswordChange = (e) => {
    const { name, value } = e.target
    setPasswordData((prev) => ({ ...prev, [name]: value }))
  }

  /**
   * Maneja el cambio en el campo de teléfono, permitiendo solo caracteres válidos.
   * @param {Object} e - Evento de cambio.
   */
  const handlePhoneChange = (e) => {
    // Permitir números, espacios, guiones, paréntesis y el signo +
    const value = e.target.value.replace(/[^\d\s\-$$$$+]/g, "")
    setFormData((prev) => ({ ...prev, telefono: value }))
  }

  /**
   * Valida el formato del email.
   * @param {string} email - Email a validar.
   * @returns {boolean} True si es válido.
   */
  const validateEmail = (email) => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    return emailRegex.test(email)
  }

  /**
   * Valida el formato del teléfono.
   * @param {string} phone - Teléfono a validar.
   * @returns {boolean} True si es válido.
   */
  const validatePhone = (phone) => {
    const cleanPhone = phone.replace(/[^\d]/g, "")
    return cleanPhone.length >= 7 &amp;&amp; cleanPhone.length &lt;= 15
  }

  /**
   * Abre el modal de gestión de administradores.
   * @param {"add"|"remove"} action - Acción a realizar.
   */
  const handleOpenAdminModal = (action) => {
    setAdminAction(action)
    setSelectedUserId("")
    setShowAdminModal(true)
  }

  /**
   * Ejecuta la acción de añadir o quitar permisos de administrador.
   * @async
   */
  const handleAdminAction = async () => {
    if (!selectedUserId) {
      toast.error(t("profile.mustSelectUser", "Debes seleccionar un usuario"))
      return
    }

    try {
      if (adminAction === "add") {
        await api.put(`/usuarios/${selectedUserId}`, { role: "admin" })
        toast.success(t("profile.userPromotedSuccessfully", "Usuario promovido a administrador correctamente"))
      } else {
        await api.put(`/usuarios/${selectedUserId}`, { role: "miembro" })
        toast.success(
          t("profile.adminPermissionsRevokedSuccessfully", "Permisos de administrador revocados correctamente"),
        )
      }

      const response = await api.get("/usuarios")
      const usuariosData = Array.isArray(response.data) ? response.data : response.data.data || []

      const admins = usuariosData.filter((u) => u.role === "admin" &amp;&amp; u.id !== user.id)
      const regularUsers = usuariosData.filter((u) => u.role !== "admin" &amp;&amp; u.estado === "activo")

      setAdminUsers(admins)
      setUsuarios(regularUsers)
      setShowAdminModal(false)
    } catch (error) {
      console.error("Error al modificar permisos de administrador:", error)
      toast.error(t("profile.errorModifyingAdminPermissions", "Error al modificar permisos de administrador"))
    }
  }

  /**
   * Envía el formulario para actualizar los datos personales del usuario.
   * @async
   * @param {Object} e - Evento de envío.
   */
  const handleSubmitProfile = async (e) => {
    e.preventDefault()
    setSaving(true)
    setError("")
    setSuccess("")
    setShowSpinner(true)

    try {
      // Validar email
      if (!validateEmail(formData.email)) {
        setError(t("profile.invalidEmail", "El email debe tener un formato válido (ejemplo@dominio.com)"))
        setSaving(false)
        setShowSpinner(false)
        return
      }

      // Validar teléfono
      if (!validatePhone(formData.telefono)) {
        setError(t("profile.invalidPhone", "El teléfono debe tener entre 7 y 15 dígitos"))
        setSaving(false)
        setShowSpinner(false)
        return
      }

      const fechaNac = formData.fecha_nac ? new Date(formData.fecha_nac).toISOString().split("T")[0] : null

      const userData = {
        nombre: formData.nombre,
        apellido1: formData.apellido1,
        apellido2: formData.apellido2,
        email: formData.email,
        telefono: formData.telefono,
        fecha_nac: fechaNac,
      }

      await api.put(`/usuarios/${user.id}`, userData)

      setSuccess(t("profile.dataUpdatedSuccessfully", "Datos actualizados correctamente"))

      setTimeout(() => {
        setSuccess("")
        setShowSpinner(false)
      }, 3000)
    } catch (error) {
      console.error("Error al actualizar perfil:", error)

      if (error.response &amp;&amp; error.response.status === 403) {
        setError(
          t("profile.permissionDenied", "No tienes permisos para realizar esta acción. Contacta al administrador."),
        )
      } else if (error.response &amp;&amp; error.response.status === 401) {
        setError(t("profile.unauthorized", "Tu sesión ha expirado. Por favor, inicia sesión nuevamente."))
      } else if (error.response &amp;&amp; error.response.status === 422) {
        const validationErrors = error.response.data.errors || error.response.data.message
        if (typeof validationErrors === "object") {
          const firstError = Object.values(validationErrors)[0]
          setError(Array.isArray(firstError) ? firstError[0] : firstError)
        } else {
          setError(validationErrors || "Error de validación")
        }
      } else {
        setError(t("profile.errorUpdatingProfile", "Error al actualizar los datos. Por favor, inténtalo de nuevo."))
      }
      setShowSpinner(false)
    } finally {
      setSaving(false)
    }
  }

  /**
   * Envía el formulario para cambiar la contraseña del usuario.
   * @async
   * @param {Object} e - Evento de envío.
   */
  const handleSubmitPassword = async (e) => {
    e.preventDefault()
    setSaving(true)
    setError("")
    setSuccess("")
    setShowSpinner(true)

    try {
      // Validar que las contraseñas coincidan
      if (passwordData.new_password !== passwordData.new_password_confirmation) {
        setError(t("profile.passwordMismatchError", "Las nuevas contraseñas no coinciden"))
        setSaving(false)
        setShowSpinner(false)
        return
      }

      // Validar que la contraseña sea segura
      if (!isPasswordValid) {
        setError(t("profile.passwordNotSecure", "La contraseña no cumple con los requisitos de seguridad"))
        setSaving(false)
        setShowSpinner(false)
        return
      }

      await api.put(`/usuarios/${user.id}`, {
        password: passwordData.new_password,
        password_confirmation: passwordData.new_password_confirmation,
      })

      try {
        // Enviar email de confirmación de cambio de contraseña
        const emailMessage =
          language === "en"
            ? `Dear user:\n\nYour password has been successfully changed in BandCoord. If you did not make this change, please contact the administrator immediately.\n\nIf you have any questions or need assistance, do not hesitate to contact us.\n\nThank you for trusting BandCoord.`
            : `Estimado/a usuario/a:\n\nTu contraseña ha sido cambiada correctamente en BandCoord. Si no fuiste tú quien realizó este cambio, por favor contacta con el administrador inmediatamente.\n\nSi tienes alguna duda o necesitas asistencia, no dudes en contactarnos.\n\nGracias por confiar en BandCoord.`

        const formattedMessage = emailMessage.replace(/\n/g, "&lt;br>")

        await api.post("/mailTo", {
          email: user.email,
          mensaje: formattedMessage,
        })
      } catch (emailError) {
        // console.warn("Error al enviar email de confirmación:", emailError)
      }

      setSuccess(t("profile.passwordUpdatedSuccessfully", "Contraseña actualizada correctamente"))
      setPasswordData({
        new_password: "",
        new_password_confirmation: "",
      })

      setTimeout(() => {
        setSuccess("")
        setShowSpinner(false)
      }, 3000)
    } catch (error) {
      console.error("Error al cambiar contraseña:", error)

      if (error.response &amp;&amp; error.response.status === 403) {
        setError(
          t("profile.permissionDenied", "No tienes permisos para realizar esta acción. Contacta al administrador."),
        )
      } else if (error.response &amp;&amp; error.response.status === 401) {
        setError(t("profile.unauthorized", "Tu sesión ha expirado. Por favor, inicia sesión nuevamente."))
      } else if (error.response &amp;&amp; error.response.status === 422) {
        const validationErrors = error.response.data.errors || error.response.data.message
        if (typeof validationErrors === "object") {
          const firstError = Object.values(validationErrors)[0]
          setError(Array.isArray(firstError) ? firstError[0] : firstError)
        } else {
          setError(validationErrors || "Error de validación")
        }
      } else {
        setError(t("profile.errorChangingPassword", "Error al cambiar la contraseña. Por favor, inténtalo de nuevo."))
      }
      setShowSpinner(false)
    } finally {
      setSaving(false)
    }
  }

  // Renderizado de estado de carga
  if (loading) {
    return (
      &lt;div className="container mx-auto px-4 py-8">
        &lt;div className="flex justify-center items-center h-64">
          &lt;div className="text-[#C0C0C0]">Cargando...&lt;/div>
        &lt;/div>
      &lt;/div>
    )
  }

  // Renderizado principal del perfil
  return (
    &lt;div className="container mx-auto px-4 py-8">
      &lt;div className="flex items-center mb-6">
        &lt;button
          onClick={() => navigate("/")}
          className="mr-4 p-2 text-gray-400 hover:text-[#C0C0C0] rounded-full hover:bg-gray-900/50"
        >
          &lt;ArrowLeft size={20} />
        &lt;/button>
        &lt;h1 className="text-2xl font-bold text-[#C0C0C0]">{t("profile.title", "Mi Perfil")}&lt;/h1>
      &lt;/div>

      {/* Pestañas */}
      &lt;div className="flex border-b border-gray-800 mb-6">
        &lt;button
          className={`px-4 py-2 font-medium ${
            activeTab === "datos" ? "text-[#C0C0C0] border-b-2 border-[#C0C0C0]" : "text-gray-400 hover:text-[#C0C0C0]"
          }`}
          onClick={() => setActiveTab("datos")}
        >
          {t("profile.personalData", "Datos Personales")}
        &lt;/button>
        &lt;button
          className={`px-4 py-2 font-medium ${
            activeTab === "password"
              ? "text-[#C0C0C0] border-b-2 border-[#C0C0C0]"
              : "text-gray-400 hover:text-[#C0C0C0]"
          }`}
          onClick={() => setActiveTab("password")}
        >
          {t("profile.changePassword", "Cambiar Contraseña")}
        &lt;/button>
        {user &amp;&amp; user.role === "admin" &amp;&amp; (
          &lt;button
            className={`px-4 py-2 font-medium ${
              activeTab === "admin"
                ? "text-[#C0C0C0] border-b-2 border-[#C0C0C0]"
                : "text-gray-400 hover:text-[#C0C0C0]"
            }`}
            onClick={() => setActiveTab("admin")}
          >
            {t("profile.adminManagement", "Gestión de Administradores")}
          &lt;/button>
        )}
      &lt;/div>

      {/* Mensajes de error y éxito */}
      {error &amp;&amp; (
        &lt;div className="bg-red-900/20 border border-red-800 text-red-100 px-4 py-3 rounded-md mb-6">{error}&lt;/div>
      )}

      {success &amp;&amp; (
        &lt;div className="bg-green-900/20 border border-green-800 text-green-100 px-4 py-3 rounded-md mb-6 flex items-center">
          {showSpinner ? (
            &lt;>
              &lt;div className="animate-spin mr-2 h-5 w-5 border-2 border-green-500 border-t-transparent rounded-full">&lt;/div>
              {success}
            &lt;/>
          ) : (
            &lt;>
              &lt;CheckCircle size={20} className="mr-2" />
              {success}
            &lt;/>
          )}
        &lt;/div>
      )}

      {activeTab === "admin" &amp;&amp; user &amp;&amp; user.role === "admin" &amp;&amp; (
        &lt;div className="bg-black/30 border border-gray-800 rounded-lg p-6">
          &lt;h2 className="text-xl font-semibold text-[#C0C0C0] mb-4">
            {t("profile.adminManagement", "Gestión de Administradores")}
          &lt;/h2>

          &lt;div className="flex justify-between mb-6">
            &lt;button
              onClick={() => handleOpenAdminModal("add")}
              className="flex items-center gap-2 bg-black border border-[#C0C0C0] text-[#C0C0C0] px-4 py-2 rounded-md hover:bg-gray-900 transition-colors"
            >
              &lt;UserPlus size={18} />
              {t("profile.addAdministrator", "Añadir Administrador")}
            &lt;/button>

            &lt;button
              onClick={() => handleOpenAdminModal("remove")}
              className="flex items-center gap-2 bg-gray-800 text-[#C0C0C0] px-4 py-2 rounded-md hover:bg-gray-700 transition-colors"
            >
              &lt;UserMinus size={18} />
              {t("profile.revokePermissions", "Revocar Permisos")}
            &lt;/button>
          &lt;/div>

          &lt;div className="space-y-6">
            &lt;div>
              &lt;h3 className="text-lg font-medium text-[#C0C0C0] mb-3 flex items-center">
                &lt;Shield size={18} className="mr-2" />
                {t("profile.currentAdministrators", "Administradores Actuales")}
              &lt;/h3>

              &lt;div className="bg-gray-900/30 border border-gray-800 rounded-lg overflow-hidden">
                {loadingUsers ? (
                  &lt;div className="p-4 text-center text-gray-400">{t("common.loading", "Cargando...")}&lt;/div>
                ) : adminUsers.length === 0 ? (
                  &lt;div className="p-4 text-center text-gray-400">
                    {t("profile.noOtherAdministrators", "No hay otros administradores")}
                  &lt;/div>
                ) : (
                  &lt;div className="divide-y divide-gray-800">
                    {adminUsers.map((admin) => (
                      &lt;div key={admin.id} className="p-3 flex justify-between items-center">
                        &lt;div>
                          &lt;div className="text-[#C0C0C0] font-medium">
                            {admin.nombre} {admin.apellido1} {admin.apellido2}
                          &lt;/div>
                          &lt;div className="text-gray-400 text-sm">{admin.email}&lt;/div>
                        &lt;/div>
                      &lt;/div>
                    ))}
                  &lt;/div>
                )}
              &lt;/div>
            &lt;/div>
          &lt;/div>
        &lt;/div>
      )}

      {/* Modal para añadir/quitar administradores */}
      {showAdminModal &amp;&amp; (
        &lt;div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
          &lt;div className="bg-black border border-gray-800 rounded-lg p-6 w-full max-w-md">
            &lt;h3 className="text-xl font-semibold text-[#C0C0C0] mb-4">
              {adminAction === "add"
                ? t("profile.addAdministrator", "Añadir Administrador")
                : t("profile.revokePermissions", "Revocar Permisos de Administrador")}
            &lt;/h3>

            &lt;div className="mb-6">
              &lt;label htmlFor="usuario" className="block text-[#C0C0C0] text-sm font-medium mb-2">
                {t("profile.selectUser", "Seleccionar usuario")}
              &lt;/label>
              &lt;select
                id="usuario"
                value={selectedUserId}
                onChange={(e) => setSelectedUserId(e.target.value)}
                className="w-full py-2 px-3 bg-gray-900/50 border border-gray-800 rounded-md text-[#C0C0C0] focus:outline-none focus:ring-1 focus:ring-[#C0C0C0] focus:border-[#C0C0C0]"
              >
                &lt;option value="">{t("profile.selectUserPlaceholder", "Seleccionar usuario...")}&lt;/option>
                {adminAction === "add"
                  ? usuarios.map((usuario) => (
                      &lt;option key={usuario.id} value={usuario.id}>
                        {usuario.nombre} {usuario.apellido1} - {usuario.email}
                      &lt;/option>
                    ))
                  : adminUsers.map((admin) => (
                      &lt;option key={admin.id} value={admin.id}>
                        {admin.nombre} {admin.apellido1} - {admin.email}
                      &lt;/option>
                    ))}
              &lt;/select>
            &lt;/div>

            &lt;div className="flex justify-end space-x-3">
              &lt;button
                onClick={() => setShowAdminModal(false)}
                className="px-4 py-2 bg-gray-800 text-[#C0C0C0] rounded-md hover:bg-gray-700"
              >
                {t("common.cancel", "Cancelar")}
              &lt;/button>
              &lt;button
                onClick={handleAdminAction}
                disabled={!selectedUserId}
                className="px-4 py-2 bg-black border border-[#C0C0C0] text-[#C0C0C0] rounded-md hover:bg-gray-900 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {adminAction === "add" ? t("profile.add", "Añadir") : t("profile.revoke", "Revocar")}
              &lt;/button>
            &lt;/div>
          &lt;/div>
        &lt;/div>
      )}

      {activeTab !== "admin" &amp;&amp; (
        &lt;div className="bg-black/30 border border-gray-800 rounded-lg p-6">
          {activeTab === "datos" ? (
            &lt;form onSubmit={handleSubmitProfile}>
              &lt;div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {/* Nombre */}
                &lt;div className="space-y-2">
                  &lt;label htmlFor="nombre" className="block text-[#C0C0C0] text-sm font-medium">
                    {t("profile.name", "Nombre")} *
                  &lt;/label>
                  &lt;div className="relative">
                    &lt;div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                      &lt;UserRound size={18} />
                    &lt;/div>
                    &lt;input
                      id="nombre"
                      name="nombre"
                      value={formData.nombre}
                      onChange={handleChange}
                      required
                      className="w-full pl-10 py-2 bg-gray-900/50 border border-gray-800 rounded-md text-[#C0C0C0] placeholder:text-gray-500 focus:outline-none focus:ring-1 focus:ring-[#C0C0C0] focus:border-[#C0C0C0]"
                    />
                  &lt;/div>
                &lt;/div>

                {/* Primer apellido */}
                &lt;div className="space-y-2">
                  &lt;label htmlFor="apellido1" className="block text-[#C0C0C0] text-sm font-medium">
                    {t("profile.firstSurname", "Primer apellido")} *
                  &lt;/label>
                  &lt;input
                    id="apellido1"
                    name="apellido1"
                    value={formData.apellido1}
                    onChange={handleChange}
                    required
                    className="w-full py-2 px-3 bg-gray-900/50 border border-gray-800 rounded-md text-[#C0C0C0] placeholder:text-gray-500 focus:outline-none focus:ring-1 focus:ring-[#C0C0C0] focus:border-[#C0C0C0]"
                  />
                &lt;/div>

                {/* Segundo apellido */}
                &lt;div className="space-y-2">
                  &lt;label htmlFor="apellido2" className="block text-[#C0C0C0] text-sm font-medium">
                    {t("profile.secondSurname", "Segundo apellido")}
                  &lt;/label>
                  &lt;input
                    id="apellido2"
                    name="apellido2"
                    value={formData.apellido2}
                    onChange={handleChange}
                    className="w-full py-2 px-3 bg-gray-900/50 border border-gray-800 rounded-md text-[#C0C0C0] placeholder:text-gray-500 focus:outline-none focus:ring-1 focus:ring-[#C0C0C0] focus:border-[#C0C0C0]"
                  />
                &lt;/div>

                {/* Email (solo lectura para miembros, editable para admin) */}
                &lt;div className="space-y-2">
                  &lt;label htmlFor="email" className="block text-[#C0C0C0] text-sm font-medium">
                    {t("profile.email", "Email")}
                  &lt;/label>
                  &lt;div className="relative">
                    &lt;div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                      &lt;Mail size={18} />
                    &lt;/div>
                    &lt;input
                      id="email"
                      name="email"
                      value={formData.email}
                      onChange={user?.role === "admin" ? handleChange : undefined}
                      readOnly={user?.role !== "admin"}
                      className={`w-full pl-10 py-2 border border-gray-800 rounded-md focus:outline-none focus:ring-1 focus:ring-[#C0C0C0] focus:border-[#C0C0C0] ${
                        user?.role === "admin"
                          ? "bg-gray-900/50 text-[#C0C0C0] placeholder:text-gray-500"
                          : "bg-gray-800/50 text-gray-400 cursor-not-allowed"
                      }`}
                    />
                  &lt;/div>
                  {user?.role !== "admin" &amp;&amp; (
                    &lt;p className="text-xs text-gray-500">
                      {t("profile.emailCannotBeModified", "El email no se puede modificar")}
                    &lt;/p>
                  )}
                &lt;/div>

                {/* Teléfono */}
                &lt;div className="space-y-2">
                  &lt;label htmlFor="telefono" className="block text-[#C0C0C0] text-sm font-medium">
                    {t("profile.phone", "Teléfono")} *
                  &lt;/label>
                  &lt;div className="relative">
                    &lt;div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                      &lt;Phone size={18} />
                    &lt;/div>
                    &lt;input
                      id="telefono"
                      name="telefono"
                      type="tel"
                      value={formData.telefono}
                      onChange={handlePhoneChange}
                      required
                      className="w-full pl-10 py-2 bg-gray-900/50 border border-gray-800 rounded-md text-[#C0C0C0] placeholder:text-gray-500 focus:outline-none focus:ring-1 focus:ring-[#C0C0C0] focus:border-[#C0C0C0]"
                    />
                  &lt;/div>
                  &lt;p className="text-xs text-gray-400">
                    {t("profile.phoneHelp", "Incluye código de país si es necesario")}
                  &lt;/p>
                &lt;/div>

                {/* Fecha de nacimiento */}
                &lt;div className="space-y-2">
                  &lt;label htmlFor="fecha_nac" className="block text-[#C0C0C0] text-sm font-medium">
                    {t("profile.birthDate", "Fecha de nacimiento")} *
                  &lt;/label>
                  &lt;div className="relative">
                    &lt;div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                      &lt;Calendar size={18} />
                    &lt;/div>
                    &lt;input
                      id="fecha_nac"
                      name="fecha_nac"
                      type="date"
                      value={formData.fecha_nac}
                      onChange={handleChange}
                      required
                      className="w-full pl-10 py-2 bg-gray-900/50 border border-gray-800 rounded-md text-[#C0C0C0] focus:outline-none focus:ring-1 focus:ring-[#C0C0C0] focus:border-[#C0C0C0]"
                    />
                  &lt;/div>
                &lt;/div>
              &lt;/div>

              {/* Fecha de entrada - separate row */}
              &lt;div className="mt-6 max-w-md">
                &lt;div className="space-y-2">
                  &lt;label htmlFor="fecha_entrada" className="block text-[#C0C0C0] text-sm font-medium">
                    {t("profile.entryDate", "Fecha de entrada")}
                  &lt;/label>
                  &lt;div className="relative">
                    &lt;div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                      &lt;Calendar size={18} />
                    &lt;/div>
                    &lt;input
                      id="fecha_entrada"
                      name="fecha_entrada"
                      type="date"
                      value={formData.fecha_entrada}
                      readOnly
                      className="w-full pl-10 py-2 bg-gray-800/50 border border-gray-800 rounded-md text-gray-400 cursor-not-allowed"
                    />
                  &lt;/div>
                  &lt;p className="text-xs text-gray-500">
                    {t("profile.entryDateCannotBeModified", "La fecha de entrada no se puede modificar")}
                  &lt;/p>
                &lt;/div>
              &lt;/div>

              &lt;div className="mt-8 flex justify-end">
                &lt;button
                  type="submit"
                  disabled={saving}
                  className="px-4 py-2 bg-black border border-[#C0C0C0] text-[#C0C0C0] rounded-md hover:bg-gray-900 transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed"
                >
                  &lt;Save size={18} />
                  {saving ? t("profile.saving", "Guardando...") : t("profile.saveChanges", "Guardar cambios")}
                &lt;/button>
              &lt;/div>
            &lt;/form>
          ) : (
            &lt;form onSubmit={handleSubmitPassword}>
              &lt;div className="space-y-6 max-w-md mx-auto">
                {/* Nueva contraseña */}
                &lt;div className="space-y-2">
                  &lt;label htmlFor="new_password" className="block text-[#C0C0C0] text-sm font-medium">
                    {t("profile.newPassword", "Nueva contraseña")} *
                  &lt;/label>
                  &lt;div className="relative">
                    &lt;div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                      &lt;Lock size={18} />
                    &lt;/div>
                    &lt;input
                      id="new_password"
                      name="new_password"
                      type={showNewPassword ? "text" : "password"}
                      value={passwordData.new_password}
                      onChange={handlePasswordChange}
                      required
                      className="w-full pl-10 pr-10 py-2 bg-gray-900/50 border border-gray-800 rounded-md text-[#C0C0C0] placeholder:text-gray-500 focus:outline-none focus:ring-1 focus:ring-[#C0C0C0] focus:border-[#C0C0C0]"
                    />
                    &lt;button
                      type="button"
                      onClick={() => setShowNewPassword(!showNewPassword)}
                      className="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-[#C0C0C0]"
                    >
                      {showNewPassword ? &lt;EyeOff size={18} /> : &lt;Eye size={18} />}
                    &lt;/button>
                  &lt;/div>
                  &lt;PasswordValidator password={passwordData.new_password} onValidationChange={setIsPasswordValid} />
                &lt;/div>

                {/* Confirmar nueva contraseña */}
                &lt;div className="space-y-2">
                  &lt;label htmlFor="new_password_confirmation" className="block text-[#C0C0C0] text-sm font-medium">
                    {t("profile.confirmPassword", "Confirmar nueva contraseña")} *
                  &lt;/label>
                  &lt;div className="relative">
                    &lt;div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                      &lt;Lock size={18} />
                    &lt;/div>
                    &lt;input
                      id="new_password_confirmation"
                      name="new_password_confirmation"
                      type={showConfirmPassword ? "text" : "password"}
                      value={passwordData.new_password_confirmation}
                      onChange={handlePasswordChange}
                      required
                      className="w-full pl-10 pr-10 py-2 bg-gray-900/50 border border-gray-800 rounded-md text-[#C0C0C0] placeholder:text-gray-500 focus:outline-none focus:ring-1 focus:ring-[#C0C0C0] focus:border-[#C0C0C0]"
                    />
                    &lt;button
                      type="button"
                      onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                      className="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-[#C0C0C0]"
                    >
                      {showConfirmPassword ? &lt;EyeOff size={18} /> : &lt;Eye size={18} />}
                    &lt;/button>
                  &lt;/div>
                &lt;/div>

                &lt;div className="mt-8 flex justify-end">
                  &lt;button
                    type="submit"
                    disabled={saving || !isPasswordValid}
                    className="px-4 py-2 bg-black border border-[#C0C0C0] text-[#C0C0C0] rounded-md hover:bg-gray-900 transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed"
                  >
                    &lt;Save size={18} />
                    {saving
                      ? t("profile.saving", "Guardando...")
                      : t("profile.changePasswordButton", "Cambiar contraseña")}
                  &lt;/button>
                &lt;/div>
              &lt;/div>
            &lt;/form>
          )}
        &lt;/div>
      )}
    &lt;/div>
  )
}
</code></pre>
        </article>
    </section>




    
    
</div>


<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Mon Jun 09 2025 13:51:24 GMT+0200 (hora de verano de Europa central) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
